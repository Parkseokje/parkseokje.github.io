<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>석제의 블로그</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="석제의 블로그">
<meta property="og:url" content="http://parkseokje.github.io/index.html">
<meta property="og:site_name" content="석제의 블로그">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="석제의 블로그">
  
    <link rel="alternate" href="/atom.xml" title="석제의 블로그" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">석제의 블로그</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://parkseokje.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-jwt" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/jwt/" class="article-date">
  <time datetime="2017-03-07T04:22:40.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/jwt/">jwt</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>JWT</strong></p>
<p>JSON Web Token 의 약자로서, 간단히 말하면, 사용자가 누구이고,<br>무엇을 할 수 있는지에 대한 정보를 담고 있는 객체이다.</p>
<p>서버로부터 클라이언트로 발급되며, 위변조 여부를 알 수 있도록<br>비밀키로 암호화 된다. 로그인과 같은 인증모듈에 사용되며,<br>사용자에 대한 정보를 세션에 저장하지 않는 컨셉이기 때문에<br>클라이언트는 이렇게 받은 토큰을 안전한 장소에 저장해야 한다.</p>
<p>또한 매 서버 요청 시 이 토큰을 헤더나 쿼리 파라미터 등에 포함시켜 보내야 한다.</p>
<p>자 그럼 바로, Node Express 예제를 통해 알아보자. (<a href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/skeleton_website" target="_blank" rel="external">express 프로젝트 생성</a>)</p>
<p><strong>Passport</strong></p>
<p>간단히 말하면, Node.js용 범용 인증 모듈이다.<br>아래 준비물에 나와있는 passport-jwt 는 passport 의 수많은 인증방식(Strategy) 중<br>JWT 를 결합하여 사용할 수 있도록 만들어진 모듈이다.</p>
<p><strong>설치</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save passport, passport-jwt, jwt-simple</div></pre></td></tr></table></figure></p>
<p><strong>routes/users.js</strong></p>
<p>사용자 인증을 위한 Fake 데이터</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> users = [&#123;</div><div class="line">  <span class="attr">id</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">name</span>: <span class="string">'John'</span>,</div><div class="line">  <span class="attr">email</span>: <span class="string">'john@mail.com'</span>,</div><div class="line">  <span class="attr">phone</span>: <span class="string">'01012341234'</span>,</div><div class="line">  <span class="attr">password</span>: <span class="string">'1111'</span></div><div class="line">&#125;, &#123;</div><div class="line">  <span class="attr">id</span>: <span class="number">2</span>,</div><div class="line">  <span class="attr">name</span>: <span class="string">'Sarah'</span>,</div><div class="line">  <span class="attr">email</span>: <span class="string">'sarah@mail.com'</span>,</div><div class="line">  <span class="attr">phone</span>: <span class="string">'01023456789'</span>,</div><div class="line">  <span class="attr">password</span>: <span class="string">'2222'</span></div><div class="line">&#125;];</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = users;</div></pre></td></tr></table></figure>
<p><strong>secret/jwt_config.js</strong></p>
<p>비밀키. 반드시 .gitignore 시키자.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="comment">// 토큰을 인코딩/디코딩하기 위한 비밀키로 사용된다.</span></div><div class="line">  jwtSecret: <span class="string">'ilovecode'</span>,</div><div class="line">  <span class="comment">// Passport 세션을 이용하지 않도록 알려주는 역할을 한다.</span></div><div class="line">  jwtSession: &#123;</div><div class="line">    <span class="attr">session</span>: <span class="literal">false</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>routes/auth.js</strong></p>
<p>사용자 인증을 처리할 모듈</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">'passport'</span>);</div><div class="line"><span class="keyword">var</span> passportJWT = <span class="built_in">require</span>(<span class="string">'passport-jwt'</span>);</div><div class="line"><span class="keyword">var</span> users = <span class="built_in">require</span>(<span class="string">'./users'</span>);</div><div class="line"><span class="keyword">var</span> cfg = <span class="built_in">require</span>(<span class="string">'../secret/jwt_config'</span>);</div><div class="line"><span class="keyword">var</span> ExtractJwt = passportJWT.ExtractJwt;</div><div class="line"><span class="keyword">var</span> Strategy = passportJWT.Strategy;</div><div class="line"><span class="keyword">var</span> params = &#123;</div><div class="line">  <span class="comment">// JWT 비밀키</span></div><div class="line">  secretOrKey: cfg.jwtSecret,</div><div class="line">  <span class="comment">// 클라이언트에서 서버로 토큰을 전달하는 방식  (header, querystring, body 등이 있다.)</span></div><div class="line">  <span class="comment">// header 의 경우 다음과 같이 써야 한다 &#123; key: 'Authorization', value: 'JWT' + 토큰</span></div><div class="line">  jwtFromRequest: ExtractJwt.fromAuthHeader()</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> strategy = <span class="keyword">new</span> Strategy(params, <span class="function"><span class="keyword">function</span> (<span class="params">payload, done</span>) </span>&#123;</div><div class="line">    <span class="comment">// TODO write authentications to find users from a database</span></div><div class="line">    <span class="keyword">var</span> user = users.find(<span class="function"><span class="keyword">function</span> (<span class="params">u</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> u.id === payload.id;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">if</span> (user) &#123;</div><div class="line">      <span class="keyword">return</span> done(<span class="literal">null</span>, &#123;</div><div class="line">        <span class="attr">id</span>: user.id</div><div class="line">      &#125;);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> done(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'User not found'</span>), <span class="literal">null</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">  passport.use(strategy);</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">initialize</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> passport.initialize();</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">authenticate</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> passport.authenticate(<span class="string">'jwt'</span>, cfg.jwtSession);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>app.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</div><div class="line"><span class="keyword">var</span> auth = <span class="built_in">require</span>(<span class="string">'./routes/auth'</span>)(); <span class="comment">// 위의 auth.js 를 추가한다.</span></div><div class="line">...</div><div class="line"></div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</div><div class="line">app.use(auth.initialize()); <span class="comment">// 초기화</span></div></pre></td></tr></table></figure>
<p><strong>routes/index.js</strong></p>
<p>2개의 라우터를 정의한다.</p>
<ul>
<li>/login: 로그인 요청. 토큰을 발급한다.</li>
<li>/secret: 토큰을 통해 사용자 정보를 획득한다.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> router = express.Router();</div><div class="line"><span class="keyword">var</span> jwt = <span class="built_in">require</span>(<span class="string">'jwt-simple'</span>);</div><div class="line"><span class="keyword">var</span> auth = <span class="built_in">require</span>(<span class="string">'./auth'</span>)();</div><div class="line"><span class="keyword">var</span> users = <span class="built_in">require</span>(<span class="string">'./users'</span>);</div><div class="line"><span class="keyword">var</span> cfg = <span class="built_in">require</span>(<span class="string">'../secret/jwt_config'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 로그인 요청을 처리한다.</span></div><div class="line"><span class="comment">// 1. body 에 포함된 전화번호와 암호가 일치하는 사용자를 찾는다.</span></div><div class="line"><span class="comment">// 2. 토큰(payload + 비밀키) 생성 및 전송</span></div><div class="line">router.post(<span class="string">'/login'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (req.body.phone &amp;&amp; req.body.password) &#123;</div><div class="line">    <span class="keyword">var</span> phone = req.body.phone;</div><div class="line">    <span class="keyword">var</span> password = req.body.password;</div><div class="line">    <span class="keyword">var</span> user = users.find(<span class="function"><span class="keyword">function</span> (<span class="params">u</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> u.phone === phone &amp;&amp; u.password === password;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">if</span> (user) &#123;</div><div class="line">      <span class="keyword">var</span> payload = &#123;</div><div class="line">        <span class="attr">id</span>: user.id</div><div class="line">      &#125;;</div><div class="line">      <span class="keyword">var</span> token = jwt.encode(payload, cfg.jwtSecret);</div><div class="line">      res.json(&#123;</div><div class="line">        <span class="attr">token</span>: token</div><div class="line">      &#125;);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      res.sendStatus(<span class="number">401</span>);</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    res.sendStatus(<span class="number">401</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 클라이언트로부터 전송된 요청 헤더에 포함된 토큰으로부터 사용자 정보를 반환한다.</span></div><div class="line">router.get(<span class="string">'/secret'</span>, auth.authenticate(), <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(req.user);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = router;</div></pre></td></tr></table></figure>
<p><strong>테스트</strong></p>
<figure class="highlight plain"><figcaption><span>start``` 또는 [nodemon 으로 서버를 실행]하고 Postman 등으로 테스트해보자</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">```</div><div class="line">[POST, 토큰 획득]</div><div class="line">http://localhost:3000/login, [BODY] phone: 01012341234, password: 1111</div><div class="line">(Postman 으로 할 경우 x-www-form-urlencoded 옵션 선택)</div><div class="line"></div><div class="line">[GET, 위 토큰을 통해 사용자 정보 획득]</div><div class="line">http://localhost:3000/secret, [HEADER] key: Authorization, value: 토큰</div></pre></td></tr></table></figure>
<p><strong>참고</strong></p>
<ol>
<li><a href="https://blog.jscrambler.com/implementing-jwt-using-passport/" target="_blank" rel="external">Implementing JWT using Passport</a></li>
<li><a href="https://jonathanmh.com/express-passport-json-web-token-jwt-authentication-beginners/" target="_blank" rel="external">Express, Passport and JSON Web Token (jwt) Authentication for Beginners</a></li>
<li><a href="http://passportjs.org/" target="_blank" rel="external">passport</a></li>
<li><a href="https://github.com/themikenicholson/passport-jwt" target="_blank" rel="external">passport-jwt</a></li>
<li><a href="https://jwt.io/" target="_blank" rel="external">jwt</a></li>
<li><a href="http://toon.io/understanding-passportjs-authentication-flow/" target="_blank" rel="external">Understanding passport.js authentication flow</a></li>
<li><a href="https://stormpath.com/blog/nodejs-jwt-create-verify" target="_blank" rel="external">Create and Verify JWTs with Node.js</a></li>
<li><a href="http://webframeworks.kr/tutorials/expressjs/auth_log_in_out/#" target="_blank" rel="external">ExpressJS 에서 로그인/로그아웃 구현하기</a></li>
<li><a href="http://bcho.tistory.com/999" target="_blank" rel="external">JWT(JSON Web Token)을 이용한 API 인증 - #1 개념 소개</a></li>
<li><a href="http://bcho.tistory.com/1000" target="_blank" rel="external">REST JWT(JSON Web Token)소개 - #2 node.js에서 JWT 사용하기</a></li>
<li><a href="https://blog.outsider.ne.kr/1160" target="_blank" rel="external">JWT에 대하여</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/jwt/" data-id="cizz17nxn00048h6b0v364con" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/api/">api</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/expressjs/">expressjs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/passport/">passport</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-apidoc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/apidoc/" class="article-date">
  <time datetime="2017-03-07T04:22:10.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/apidoc/">apidoc</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>swagger 로 api 문서화를 해보려 하였으나, 아래 부분에서 막혔다.</p>
<ul>
<li>기존 nodejs + express 방식에 적용하고자 할 경우</li>
<li>yaml 파일을 route 또는 특정 그룹별로 분리하고자 할 경우</li>
<li>yaml 파일에 api spec 작성도 해야하고, api 개발은 또 별도로 해야하고..</li>
<li>기능이 방대한 만큼 배워야할 게 많고 Best practice 를 찾기가 어렵다.</li>
</ul>
<p>욕심이 가는 모듈이지만, 일단 접기로 했다.</p>
<p>그래서 <figure class="highlight plain"><figcaption><span>하고 숨겨놨던 [apidoc](http://apidocjs.com/) 을 다시 꺼내어보았다.</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**설치**</div><div class="line">```javascript</div><div class="line">npm install apidoc -g</div></pre></td></tr></table></figure></p>
<p><strong>package.json 수정</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="string">"apidoc"</span>: &#123;</div><div class="line">  <span class="string">"title"</span>: <span class="string">"API 제목"</span>,</div><div class="line">  <span class="string">"description"</span>: <span class="string">"API 설명"</span>,</div><div class="line">  <span class="string">"url"</span>: <span class="string">"https://my_api_domain/api/v1"</span></div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p><strong>comment 작성</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">(예시)</div><div class="line"><span class="comment">/**</span></div><div class="line"> * @api &#123;get&#125; /user/:id Get User information</div><div class="line"> * @apiVersion 0.1.0</div><div class="line"> * @apiName GetUser</div><div class="line"> * @apiGroup User</div><div class="line"> *</div><div class="line"> * @apiParam &#123;Number&#125; id Users unique ID.</div><div class="line"> *</div><div class="line"> * @apiSuccess &#123;String&#125; firstname Firstname of the User.</div><div class="line"> * @apiSuccess &#123;String&#125; lastname  Lastname of the User.</div><div class="line"> *</div><div class="line"> * @apiSuccessExample Success-Response:</div><div class="line"> *     HTTP/1.1 200 OK</div><div class="line"> *     &#123;</div><div class="line"> *       "firstname": "John",</div><div class="line"> *       "lastname": "Doe"</div><div class="line"> *     &#125;</div><div class="line"> *</div><div class="line"> * @apiError UserNotFound The id of the User was not found.</div><div class="line"> *</div><div class="line"> * @apiErrorExample Error-Response:</div><div class="line"> *     HTTP/1.1 404 Not Found</div><div class="line"> *     &#123;</div><div class="line"> *       "error": "UserNotFound"</div><div class="line"> *     &#125;</div><div class="line"> */</div><div class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  res.render(<span class="string">'index'</span>, &#123; <span class="attr">title</span>: <span class="string">'Hello World'</span> &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><strong>package.json</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(예시)</div><div class="line">  "scripts": &#123;</div><div class="line">    "start": "node ./bin/www",</div><div class="line">    "dev": "nodemon ./bin/www",</div><div class="line">    "apidoc": "apidoc -i ./routes -o ./public/apidoc"</div><div class="line">  &#125;,</div></pre></td></tr></table></figure></p>
<p><strong>API 문서생성 1 (package.json 이용)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm run apidoc</div></pre></td></tr></table></figure></p>
<p><strong>API 문서생성 2(apidoc CLI 이용)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apidoc -i [target folder, ex: ./routes] -o [destination folder, ex: ./public/apidoc]</div></pre></td></tr></table></figure></p>
<p><strong>출력결과</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">output:</div><div class="line">info: Done.</div></pre></td></tr></table></figure></p>
<p><strong>서버실행 후 확인</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm run dev</div><div class="line">localhost:3000/apidoc</div></pre></td></tr></table></figure></p>
<p>잠깐 사용해본 결과, 셋업이 상당히 간단하고, 문서화도 잘되어 있다.<br>swagger 의 tools, authenticate, api test 와 같은 built-in은 없지만, 개발자 간의 의사소통을<br>위해서는 적당한 것 같다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/apidoc/" data-id="cizz17nxd00008h6bn79wo2dl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-swagger" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/swagger/" class="article-date">
  <time datetime="2017-03-07T04:21:38.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/swagger/">swagger</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>예전부터 들어만 보았지 실제로 사용해본적이 없었던 [Swagger] 에 대해 간단한 경험을 공유해보려 한다.<br>우선 해당 사이트의 설명을 보면, 아래와 같다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Swagger is a powerful open source framework backed</div><div class="line">by a large ecosystem of tools</div><div class="line">that helps you design, build, document,</div><div class="line">and consume your RESTful APIs.</div><div class="line"></div><div class="line">Swagger (스웨거) 는 수많은 도구로 이루어진 에코시스템이 뒷받침하고 있으며,</div><div class="line">RESTful API를 디자인하고, 빌드하고, 문서화하며, 소비할 수 있도록</div><div class="line">도와주는 강력한 오프소스 프레임웍이다.</div></pre></td></tr></table></figure>
<p>음.. 에코시스템은 뭐고,<br>API 는 알겠는데, RESTful 은 뭘까?</p>
<p>에코시스템의 사전적 의미는 <a href="https://www.merriam-webster.com/dictionary/ecosystem" target="_blank" rel="external">여기</a>에서 확인할 수 있다.<br>여기서의 에코시스템은 Swagger 에는 다양한 라이브러리와 프레임웍으로<br>구성된 <a href="http://swagger.io/open-source-integrations/" target="_blank" rel="external">툴</a>들이 존재하는데, 이들을 묶어서 부르는 것으로 풀이하면 무방할 것 같다.<br>RESTful에 대한 자세한 설명은 <a href="http://www.iamcorean.net/22" target="_blank" rel="external">이곳</a>을 참고해주기 바란다.</p>
<p>그래서 Swagger 를 이용해서 무엇을 어떻게 하는건가?<br>간단히 말해서, node express 기반으로 만들어진 swagger-express<br>를 이용해 API를 개발한 다음(기존 express 개발 방식과는 완전히 상이하다.), swagger-express 서버를 실행시키면,<br>API 서비스를 제공할 수 있게되며, 별도로 작성한 Swagger 에디터를 이용해 작성한, API 문서를 포함시키면,<br>API 문서도 서비스로 제공할 수 있다는 것이다.</p>
<p><strong>그럼 바로 시작해보자.</strong> </p>
<p>아래 내용은 기본적인 준비사항이다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">1. swagger-node 글로벌 설치</div><div class="line">npm install -g swagger</div><div class="line"></div><div class="line">2. 프로젝트 생성</div><div class="line">swagger project create [project_name]</div><div class="line">cd [project_name]</div><div class="line"></div><div class="line">(선택사항)</div><div class="line">git init</div><div class="line">git remote add [remote_url])</div><div class="line">git pull origin [remote_branch] --allow-unrelated-histories</div><div class="line">(git repo 생성 시 .gitignore/readme 파일을 추가한 경우)</div><div class="line"></div><div class="line">3.API 디자인</div><div class="line">swagger project edit 또는</div><div class="line">IDE에서 api/swagger/swagger.yaml 파일을 직접 수정</div><div class="line"></div><div class="line">4. 프로젝트 시작</div><div class="line">swagger project start</div><div class="line">curl http://127.0.0.1:10010/hello?name=Scott</div><div class="line">(&quot;Hello, Scott!&quot; 가 찍히면, 성공)</div></pre></td></tr></table></figure>
<p>그다음 API 문서를 웹페이지로 제공해주는 swagger ui를 설정해보자.</p>
<p><strong>app.js</strong> 에 추가<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> SwaggerUi = <span class="built_in">require</span>(<span class="string">'swagger-tools/middleware/swagger-ui'</span>);</div><div class="line"></div><div class="line">SwaggerExpress.create(config, <span class="function"><span class="keyword">function</span>(<span class="params">err, swaggerExpress</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// add swagger-ui (/docs)</span></div><div class="line">  app.use(SwaggerUi(swaggerExpress.runner.swagger));</div><div class="line"></div><div class="line">  <span class="comment">// install middleware</span></div><div class="line">  swaggerExpress.register(app);</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><figcaption><span>를 실행해보자.</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">다음 사항으로는, API 접근을 위한 보안설정을 해보자.</div><div class="line"></div><div class="line">**app.js** 에 추가</div><div class="line">```javascript</div><div class="line">var config = &#123;</div><div class="line">  appRoot: __dirname, // required config</div><div class="line"></div><div class="line">  swaggerSecurityHandlers: &#123;</div><div class="line">    api_key: function (req, authOrSecDef, scopesOrApiKey, cb) &#123;</div><div class="line">      // your security code</div><div class="line">      // 요청 헤더값이 api_key 이고 값이 1234 일 경우에만 실행을 허용한다</div><div class="line">      if (&apos;1234&apos; === scopesOrApiKey) &#123;</div><div class="line">        cb();</div><div class="line">      &#125; else &#123;</div><div class="line">        cb(new Error(&apos;access denied!&apos;));</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>api/swagger/swagger.yaml</strong> 에 추가<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># api security</span></div><div class="line"><span class="attr">securityDefinitions:</span></div><div class="line">  <span class="comment"># 오픈 api일 경우</span></div><div class="line"><span class="attr">  UserSecurity:</span></div><div class="line"><span class="attr">    type:</span> basic</div><div class="line">  <span class="comment"># POST, DELETE, UPDATE 등에 적용</span></div><div class="line"><span class="attr">  AdminSecurity:</span></div><div class="line"><span class="attr">    type:</span> apiSecretKey</div><div class="line"><span class="attr">    in:</span> header</div><div class="line">    <span class="comment">#name 이 변경되면 반드시 app.js 의 api_key 또한</span></div><div class="line">    <span class="comment">#adminSecretKey 로 변경해야한다!</span></div><div class="line"><span class="attr">    name:</span> adminSecretKey <span class="comment"># 사용자 정의</span></div><div class="line">  <span class="comment"># 이미지와 같은 정적 파일들에 대해 적용 (선택)</span></div><div class="line"><span class="attr">  MediaSecurity:</span></div><div class="line"><span class="attr">    type:</span> apiKey</div><div class="line"><span class="attr">    in:</span> query</div><div class="line"><span class="attr">    name:</span> mediaSecretKey <span class="comment"># 사용자 정의</span></div><div class="line"></div><div class="line"><span class="comment">#아래 path 부분에 security 에 대한 설정이 없을 경우 디폴트로 적용</span></div><div class="line"><span class="attr">security:</span></div><div class="line"><span class="attr">  - UserSecurity:</span> []</div><div class="line"><span class="comment">#path</span></div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>securityDefinitions 속성명이 변경되는 경우에는,<br>아래 부분도 함께 <span class="red">변경</span>해주어야 한다.</p>
<p><strong>app.js</strong> 수정<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var config = &#123;</div><div class="line">  appRoot: __dirname,</div><div class="line">  swaggerSecurityHandlers: &#123;</div><div class="line">    AdminSecurity: ... &lt;--</div></pre></td></tr></table></figure></p>
<p><strong>api/swagger/swagger.yaml</strong> 에 추가<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="attr">paths:</span></div><div class="line">  /hello:</div><div class="line">    <span class="comment"># binds a127 app logic to a route</span></div><div class="line"><span class="attr">    x-swagger-router-controller:</span> hello_world</div><div class="line"><span class="attr">    get:</span></div><div class="line"><span class="attr">      description:</span> Returns <span class="string">'Hello'</span> to the caller</div><div class="line">      <span class="comment"># GET /hello 요청이 들어왔을 경우에만 적용할 security</span></div><div class="line"><span class="attr">      security:</span></div><div class="line"><span class="attr">        - AdminSecurity:</span> []</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p><strong>실패 테스트</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl http://127.0.0.1:10010/hello?name=Scott</div><div class="line">&#123;&quot;message&quot;:&quot;access denied!&quot;,&quot;code&quot;:&quot;server_error&quot;,&quot;statusCode&quot;:403&#125;</div></pre></td></tr></table></figure></p>
<p><span class="red">access denied</span> 되었다는 것을 볼 수 있다.</p>
<p><strong>성공 테스트</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -X GET --header &apos;adminSecretKey: 1234&apos; http://localhost:10010/hello?name=Scott</div><div class="line">&quot;Hello, Scott!&quot;</div></pre></td></tr></table></figure></p>
<p>정상적으로 결과가 반한된다.</p>
<p><strong>TODO</strong></p>
<p>추후 서버에 올려서 테스트를 진행해볼 것</p>
<p><strong>참고</strong></p>
<ul>
<li><a href="http://apihandyman.io/writing-openapi-swagger-specification-tutorial-part-6-defining-security/" target="_blank" rel="external">API Handyman - defining security</a></li>
<li><a href="http://blog.jeonghwan.net/swagger-node/" target="_blank" rel="external">김정환님의 블로그</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/swagger/" data-id="cizz17nxv00098h6bi5sydy8m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/api/">api</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-realty" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/realty/" class="article-date">
  <time datetime="2017-03-07T04:21:01.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/realty/">부동산 공부</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>부동산 경제학 (김정용 저)</strong></p>
<ul>
<li>청약은 주택 수요가 많은 광역시나 지는 구도심보다는 떠오르는 신도심, 대규모 택지 개발 지구, 그동안 아파트 공급이 뜸해서 신규 주택 수요가 많은 지역부터 노리는 것이 좋다.</li>
<li>발전 가능성이 높은 지역은 10년간 집값이 몇 배로 뛰기 때문에 이왕이면 이런 곳에 집을 마련하는 것이 재테크의 기본</li>
<li>서울이라면 1가구 1주택으로 3년 이상의 보유 기간에 2년 거주를 해야 양도소득세가 비과세되지만 경기도(과천, 5대 신도시 제외)의 경우 3년간 보유만 하면 양도소득세가 면제되므로 투자 이익을 극대화할 수 있는 것</li>
<li>아파트에 투자를 하려고 한다면 지방보다는 수도권에 투자하는 것이 좋다. 왜냐하면 향후 가격 상승면에서 지방보다는 서울, 수도권이 낫기 때문</li>
<li>새 아파트를 매입하고 1년 이내에 비과세 요건을 충족한 기존 주택을 매도하면 양도소득세가 비과세되기 때문</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/realty/" data-id="cizz17nxp00058h6bd7j4u7s2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/부동산/">부동산</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/제태크/">제태크</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-terminalTips" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/terminalTips/" class="article-date">
  <time datetime="2017-03-07T04:08:43.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/terminalTips/">Terminal Tips</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>사용중인 포트 확인 및 제거</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo lsof -i :port</div><div class="line">sudo kill -9 pid</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/terminalTips/" data-id="cizz17nxw000a8h6b5knks8yc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iterm/">iterm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-runkit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/runkit/" class="article-date">
  <time datetime="2017-03-07T02:38:56.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/runkit/">runkit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong><a href="https://medium.com/@kalin.chernev/reflecting-on-node-js-design-patterns-6cc6eaa584#.uo8rqyv38" target="_blank" rel="external">medium</a></strong> 에서 node.js 디자인 패턴 관련 글을 읽다가 아무 생각없이<br>클릭해봤는데 뭔가 대단해보이는 서비스를 발견했다.</p>
<p>그 이름은 바로 <strong><a href="https://runkit.com/home" target="_blank" rel="external">runkit</a></strong></p>
<p>저자는 일일이 로컬에 노드 모듈을 설치해서 테스트 해보기 귀찮으면, 이 걸 써보라고 권장하고 있다.<br>샘플로 제공하는 코드를 보면 우주 정거장의 위치를 제공해주는 소스코드도 포함되어 있다.<br>현재시간 기준으로 네팔을 지나가고 있다ㅋ</p>
<p>들어가보니 깃 계정으로 사인업을 거친 후에는 nodebook 이라는 유닛을 생성할 수 있으며,<br>이 안에 여러가지 스크립트를 작성할 수 있다. 사용하고 싶은 노드 모듈은 import 만 하면 된다.</p>
<p>깃과 연동이 되며 노트북 마다 유니크한 키로 새로운 깃 저장소가 생성되는 구조이며, 실행결과를<br>바로 확인해볼 수 있다. 또한 제공되는 endpoint (url) 를 통해, 브라우져나 터미널에서 curl 명령어로 리턴 결과를 확인해 볼 수도 있다.</p>
<p>개발 단계에서 목업 API를 개발하거나 간단한 코드를 빠른 시간 내에 검증해볼 수 있다는<br>장점이 있을 것 같다. <code>나중에봐야징ㅋ</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/runkit/" data-id="cizz17nxr00068h6brd6n0h5p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tool/">tool</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-codeReview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/codeReview/" class="article-date">
  <time datetime="2017-03-07T02:36:02.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/codeReview/">codeReview</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="종류"><a href="#종류" class="headerlink" title="종류"></a>종류</h2><p><table><br>    <thead><br>        <tr><br>            <th>리뷰</th><br>      <th>시기</th><br>            <th>효과</th><br>            <th>변경내용</th><br>      <th>수행비용</th><br>      <th>주체</th><br>        </tr><br>    </thead><br>    <tbody><br>        <tr><br>            <td>Code Inspection</td><br>            <td>1차 릴리즈<br>시스템 테스트</td><br>            <td>매우높음</td><br>      <td>매우높음</td><br>      <td>높음</td><br>      <td>PMO, QA, AA</td><br>        </tr><br>        <tr><br>            <td><span class="red">Team Review</span></td><br>            <td>매주</td><br>            <td>높음</td><br>      <td>보통</td><br>      <td>보통</td><br>      <td>PL</td><br>        </tr><br>        <tr><br>            <td>Walkthrough</td><br>            <td>비정기적</td><br>            <td>낮음</td><br>      <td>보통</td><br>      <td>낮음</td><br>      <td>원하는 개발자</td><br>        </tr><br>        <tr><br>            <td>Peer Review</td><br>            <td>필요한 경우</td><br>            <td>경우에 따라 높음</td><br>      <td>낮음</td><br>      <td>보통</td><br>      <td>시니어 개발자</td><br>        </tr><br>    </tbody><br></table><br><br></p>
<h2 id="설명"><a href="#설명" class="headerlink" title="설명"></a>설명</h2><h3 id="1-Code-Inspection"><a href="#1-Code-Inspection" class="headerlink" title="1. Code Inspection"></a>1. Code Inspection</h3><ul>
<li>사용시기 : 1차 릴리즈 (비기능, 높은 리스크, 아키텍쳐 결정 등), 시스템테스트 (개발 후반부, 성능 &amp; 안정성, 최종점검 차원), 난이도가 높은 시스템</li>
<li>수행주체 : QA 조직 내 인스펙션팀, SI 나 벤더 컨설팅 이용</li>
<li>단점: 높은 비용</li>
</ul>
<h3 id="2-Team-Review"><a href="#2-Team-Review" class="headerlink" title="2. Team Review"></a>2. Team Review</h3><ul>
<li>사용시기 : 각 개발 유닛마다</li>
<li>수행주체 : 발표자</li>
<li>후속작업 : PL은 리뷰내용을 토대로 발표자의 스케쥴 조정, 문서공유 및 테스크 관리, 테스트 및 검증</li>
</ul>
<h3 id="3-Walkthrough"><a href="#3-Walkthrough" class="headerlink" title="3. Walkthrough"></a>3. Walkthrough</h3><ul>
<li>사용시기 : 아이디어 회의를 해야하는 경우, 장애사례나 버그 수정사례 등의 정보교환이 필요한 경우, 팀원간의 실력 편차가 클 때</li>
<li>수행주체 : 특별히 정해져있지는 않으나 QA나 운영팀이 할 경우 효과적</li>
<li>단점 : 중재자가 없으므로 구성원들의 의욕이 낮을 경우 효과가 저조함.</li>
</ul>
<h3 id="4-Peer-Review"><a href="#4-Peer-Review" class="headerlink" title="4. Peer Review"></a>4. Peer Review</h3><ul>
<li>사용시기 : 신입개발자 교육, 지식공유, 품질유지가 필요한 경우</li>
<li>수행주체 : 좀 더 많이 아는 개발자가</li>
<li>단점 : 수행주체에게 많은 부담을 앉겨줄 수 있다.</li>
</ul>
<h2 id="효과적인-코드-리뷰를-위해"><a href="#효과적인-코드-리뷰를-위해" class="headerlink" title="효과적인 코드 리뷰를 위해"></a>효과적인 코드 리뷰를 위해</h2><ul>
<li>리뷰의 목적은 결함의 발견과 개선</li>
<li>인신공격, 취조하는 분위기는 금물</li>
<li>중재자의 적절한 진행</li>
<li>리뷰에 대한 후속 처리시간과 인적 리소스에 대한 조직적인 배려</li>
</ul>
<p>이상으로 요약글을 마친다.</p>
<h3 id="회고"><a href="#회고" class="headerlink" title="회고"></a>회고</h3><p>본인의 경우 팀원들과도 본 내용들을 공유하고 이해하고 토론하는 시간을 가졌다.<br>우선 릴리즈와 관련된 것은 팀리뷰로 주 1회 정도 진행하기로 하였다.<br>작은 유닛들은 온/오프 리뷰 요청을 통해 1일 1-2회로 제한하고, 가급적 하루 중 오전은 중요한 업무를 하고,<br>오후에 별도로 짬을 내어 리뷰를 진행해보기로 하였다.<br>또한 피어리뷰는 필요할 경우, 따로 시간을 정하거나 다 모일 필요없이 관련 당사자들끼리만 진행할 수 있도록 하였다.<br>리뷰 요청이 발생하면, 요청자가 pull request를 날리거나 위키에 기록하고, 리뷰 후에는 진행 및 처리결과를 업데이트하고,<br>리뷰어는 이를 알림을 통해서 받거나 정해신 시간에 확인하여, 코멘트를 달거나 별도 시간을 내서 오프로 얘기하기로 하였다.<br>오프 리뷰요청이 있을 경우 리뷰 전 최소 1시간 전에는 구성원들이 관련 사항을 미리 파악해두도록 하였다.<br>일단 이렇게 정해서 가고 중간 중간 조율해 나가기로 하였다.<br>이 실험의 결과에 대해서는 기회가 된다면, 추후 다시 포스팅하도록 하겠다.</p>
<p>이 밖에도 아래 참고 사이트에 가보시면, 다양한 관점, 방법 등에 대한<br>내용을 찾아보실 수 있으니, 꼭 <code>#나중에봐야징ㅋ</code> 해두시길</p>
<p><br><br></p>
<h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><ul>
<li><a href="http://flyburi.com/m/576" target="_blank" rel="external">조대협의 블로그 - 코드 리뷰 가이드라인 - Part 1(Code review guidelines)</a></li>
<li><a href="http://flyburi.com/m/278" target="_blank" rel="external">조대협의 블로그 - 언제 어떤 리뷰 기법을 사용할것인가? - Part 2(Code review guidelines)</a></li>
<li><a href="http://sv-story.blogspot.kr/2013/04/blog-post_28.html?m=1" target="_blank" rel="external">실리콘밸리 이야기- 코드 리뷰는 어떻게 하나요?</a></li>
<li><a href="http://www.bloter.net/archives/238819" target="_blank" rel="external">블로터 - 매끄러운 코드리뷰를 돕는 10가지 방법</a></li>
<li><a href="https://realm.io/kr/news/codereview-howto/" target="_blank" rel="external">realm - 코드리뷰, GitHub로 바로 적용하기</a></li>
<li><a href="https://brunch.co.kr/@supims/11" target="_blank" rel="external">신현묵 - 소스코드 리뷰에 대한 짧은 이야기</a></li>
<li><a href="http://tech.kakao.com/2016/02/04/code-review/" target="_blank" rel="external">카카오테크 - 코드리뷰, 어디까지 해봤니?</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/codeReview/" data-id="cizz17nxh00018h6biqttl9us" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/codereview/">codereview</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-connectionPool" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/connectionPool/" class="article-date">
  <time datetime="2017-03-07T02:33:36.000Z" itemprop="datePublished">2017-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/connectionPool/">connectionPool</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://en.wikipedia.org/wiki/Connection_pool" target="_blank" rel="external">wikipedia</a></p>
<p>커넥션 풀은, 일종의 캐시(cache, 고속 기억장치)로서 DB와의 커넥션(연결)을 유지하고 있다가 새로운 요청이 들어올때마다 DB와 새로운 커넥션을 맺는 대신,<br>기존 커넥션을 재사용하여 DB 처리능력을 향상시키는데 사용된다.<br>매 사용자마다 커넥션을 맺는 것은 특히, 동적으로 DB 연결이 자주 발생하는 웹어플리케이션의 경우 많은 리소스가 소모된다.<br>커넥션이 최초 생성되면, 커넥션풀은 이를 저장하고 요청 시 이를 반환하게 된다.<br>모든 커넥션이 사용중이면, 새로운 커넥션이 생성되고 다시 또 커넥션풀에 저장된다.<br>커넥션풀은 사용자 대기시간을 줄여준다.</p>
<p>현재 node 환경에서 <a href="https://github.com/mysqljs/mysql" target="_blank" rel="external">mysqljs</a> 를 사용하고 있는데,</p>
<h3 id="commons-db-conn-js"><a href="#commons-db-conn-js" class="headerlink" title="commons/db_conn.js"></a>commons/db_conn.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../secret/db_info'</span>).dev; <span class="comment">// DB 연결정보</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> mysql.createConnection(&#123;</div><div class="line">        <span class="attr">host</span>: config.host,</div><div class="line">        <span class="attr">port</span>: config.port,</div><div class="line">        <span class="attr">user</span>: config.user,</div><div class="line">        <span class="attr">password</span>: config.password,</div><div class="line">        <span class="attr">database</span>: config.database</div><div class="line">      &#125;);</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">test_open</span>: <span class="function"><span class="keyword">function</span> (<span class="params">conn</span>) </span>&#123;</div><div class="line">      conn.connect(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;</div><div class="line">          <span class="built_in">console</span>.error(<span class="string">'mysql connection error.'</span>);</div><div class="line">          <span class="built_in">console</span>.error(err);</div><div class="line">          <span class="keyword">throw</span> err;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="built_in">console</span>.info(<span class="string">'mysql is connected successfully.'</span>);</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>이렇게 선언하고, 실제 사용 시 매 파일마다<br>아래와 같이 새로운 커넥션 인스턴스를 생성하고 있다.</p>
<h3 id="routes-something-js"><a href="#routes-something-js" class="headerlink" title="routes/something.js"></a>routes/something.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql_dbc = <span class="built_in">require</span>(<span class="string">'../commons/db_conn'</span>)();</div><div class="line"><span class="keyword">var</span> connection = mysql_dbc.init();</div></pre></td></tr></table></figure>
<p>실제로 MySQLWorkbench 의 Management 탭에서 확인해보면 실제 접속자 수는 1명인데,<br>15개의 connection 이 존재하는 것을 볼 수 있다.</p>
<p>아직 테스트 코드 검증이 끝나지 않은 상태에서 기존 파일을 덮어쓰면 대참사(?)가 벌어질 수 있으므로,<br>db_conn_pool.js 을 새롭게 생성한다.</p>
<h3 id="routes-db-conn-pool-js"><a href="#routes-db-conn-pool-js" class="headerlink" title="routes/db_conn_pool.js"></a>routes/db_conn_pool.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../secret/db_info'</span>).dev;</div><div class="line"><span class="keyword">const</span> pool = mysql.createPool(&#123;</div><div class="line">  <span class="attr">host</span>: config.host,</div><div class="line">  <span class="attr">port</span>: config.port,</div><div class="line">  <span class="attr">user</span>: config.user,</div><div class="line">  <span class="attr">password</span>: config.password,</div><div class="line">  <span class="attr">database</span>: config.database</div><div class="line">  <span class="comment">// pool 에 담을 수 있는 connection 최대수</span></div><div class="line">  <span class="comment">// connectionLimit: 20,</span></div><div class="line">  <span class="comment">// true : 가용 connection 이 발생할 때까지 대기</span></div><div class="line">  <span class="comment">// false : 가용 connection 이 없을 경우 에러</span></div><div class="line">  <span class="comment">// waitForConnections: false</span></div><div class="line">&#125;);</div><div class="line"><span class="built_in">module</span>.exports = pool;</div></pre></td></tr></table></figure>
<h3 id="사용예"><a href="#사용예" class="headerlink" title="사용예"></a>사용예</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">pool.getConnection(<span class="function"><span class="keyword">function</span> (<span class="params">err, connection</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</div><div class="line">  connection.query(somequery, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">    connection.release();</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</div><div class="line">    <span class="comment">//release 해도 data 는 사용가능하다.</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>기존에 짜놓은 코드들을 일일히 바꾸려면,<br>시간이 꽤나 걸릴 것 같다.</p>
<p>숙제..</p>
<ol>
<li>pool 에서 커넥션이 발급/회수가 되는지 검증해보자.</li>
<li>Workbench management 대시보드의 수치가 pool과는 어떤 연관성이 있는지 파악해보자.</li>
</ol>
<p><a href="http://blog.box.kr/?p=653" target="_blank" rel="external">Andrew’s Garage</a> 에 숙제 2번에 대한 설명이 아주 상세히 잘되어 있다.</p>
<h3 id="기타-참고"><a href="#기타-참고" class="headerlink" title="기타 참고"></a>기타 참고</h3><ul>
<li><a href="http://bcho.tistory.com/892" target="_blank" rel="external">조대협의 블로그</a></li>
<li><a href="http://lng1982.tistory.com/230" target="_blank" rel="external">탁구치는 개발자</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://parkseokje.github.io/2017/03/07/connectionPool/" data-id="cizz17nxj00028h6bsm5nivak" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/codereview/">codereview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/expressjs/">expressjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iterm/">iterm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/">jwt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/passport/">passport</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/부동산/">부동산</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/제태크/">제태크</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/api/" style="font-size: 20px;">api</a> <a href="/tags/codereview/" style="font-size: 10px;">codereview</a> <a href="/tags/expressjs/" style="font-size: 10px;">expressjs</a> <a href="/tags/iterm/" style="font-size: 10px;">iterm</a> <a href="/tags/jwt/" style="font-size: 10px;">jwt</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/passport/" style="font-size: 10px;">passport</a> <a href="/tags/tool/" style="font-size: 10px;">tool</a> <a href="/tags/부동산/" style="font-size: 10px;">부동산</a> <a href="/tags/제태크/" style="font-size: 10px;">제태크</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/07/jwt/">jwt</a>
          </li>
        
          <li>
            <a href="/2017/03/07/apidoc/">apidoc</a>
          </li>
        
          <li>
            <a href="/2017/03/07/swagger/">swagger</a>
          </li>
        
          <li>
            <a href="/2017/03/07/realty/">부동산 공부</a>
          </li>
        
          <li>
            <a href="/2017/03/07/terminalTips/">Terminal Tips</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Seokje Park<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>